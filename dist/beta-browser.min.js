/*!
betajs-browser - v1.0.0 - 2015-03-26
Copyright (c) Oliver Friedmann
MIT Software License.
*/
var Scoped=function(){function a(a){function b(a){return d.extend({route:null,parent:null,children:{},watchers:[],data:{},ready:!1,lazy:[]},a)}function c(a){if(!a.ready){if(a.parent&&!a.parent.ready)return void c(a.parent);if(a.route in a.parent.data){a.data=a.parent.data[a.route],a.ready=!0;for(var b=0;b<a.watchers.length;++b)a.watchers[b].callback.call(a.watchers[b].context||this,a.data);a.watchers=[];for(var d in a.children)c(a.children[d])}}}function e(b){if(!b.ready){b.parent&&!b.parent.ready&&e(b.parent),b.ready=!0,a.tree&&"object"==typeof b.parent.data&&(b.parent.data[b.route]=b.data);for(var c=0;c<b.watchers.length;++c)b.watchers[c].callback.call(b.watchers[c].context||this,b.data);b.watchers=[]}}function f(a,b){if("object"==typeof b)for(var d in b)a.data[d]=b[d],a.children[d]&&(a.children[d].data=b[d]);else a.data=b;e(a);for(var f in a.children)c(a.children[f])}function g(a){if(a.ready&&a.data)for(var b in a.data)delete a.data[b]}function h(a){if(!a)return j;for(var d=a.split("."),e=j,f=0;f<d.length;++f)d[f]in e.children?e=e.children[d[f]]:(e.children[d[f]]=b({parent:e,route:d[f]}),e=e.children[d[f]],c(e));return e}function i(a,b,c){if(a.ready)b.call(c||this,a.data);else if(a.watchers.push({callback:b,context:c}),a.lazy.length>0){var d=function(a){if(a.lazy.length>0){var b=a.lazy.shift();b.callback.call(b.context||this,a.data),d(a)}};d(a)}}a=d.extend({tree:!1,global:!1,root:{}},a);var j=b({ready:!0}),k=null;if(a.tree){if(a.global){try{window&&(k=window)}catch(l){}try{global&&(k=global)}catch(l){}}else k=a.root;j.data=k}return{extend:function(a,b){f(h(a),b)},set:function(a,b){var c=h(a);c.data&&g(c),f(c,b)},lazy:function(a,b,c){var d=h(a);d.ready?b(c||this,d.data):d.lazy.push({callback:b,context:c})},digest:function(a){c(h(a))},obtain:function(a,b,c){i(h(a),b,c)}}}function b(e,f,g,h){var i=null,j=[],k=a({tree:!0}),l=a({tree:!1}),m={global:{namespace:h},root:{namespace:g},local:{namespace:k},"default":{namespace:l},parent:{namespace:f},scope:{namespace:k,readonly:!1}},n=function(a,b,c){var e=d.matchArgs(a,{options:"object",namespaceLocator:!0,dependencies:"array",hiddenDependencies:"array",callback:!0,context:"object"}),f=d.extend({lazy:this.options.lazy},e.options||{}),g=this.resolve(e.namespaceLocator),h=function(){this.require(e.dependencies,e.hiddenDependencies,function(){if(arguments[arguments.length-1].ns=g,this.options.compile){for(var f=[],h=0;h<a.length;++h)f.push(d.stringify(a[h]));this.compiled+=this.options.ident+"."+b+"("+f.join(", ")+");\n\n"}var i=e.callback.apply(e.context||this,arguments);c.call(this,g,i)},this)};return f.lazy?g.namespace.lazy(g.path,h,this):h.apply(this),this};return{getGlobal:d.method(c,c.getPath),setGlobal:d.method(c,c.setPath),options:{lazy:!1,ident:"Scoped",compile:!1},compiled:"",nextScope:function(){return i||(i=b(this,k,g,h)),i},subScope:function(){var a=this.nextScope();return j.push(a),i=null,a},binding:function(b,c,e){if(!m[b]||!m[b].readonly){var f;f="string"!=d.typeOf(c)?{namespace:a({tree:!0,root:c}),path:null}:this.resolve(c),m[b]=d.extend(e,f)}return this},resolve:function(a){var b=a.split(":");if(1==b.length)return{namespace:l,path:b[0]};var c=m[b[0]];if(!c)throw"The namespace '"+b[0]+"' has not been defined (yet).";return{namespace:c.namespace,path:c.path&&b[1]?c.path+"."+b[1]:c.path||b[1]}},define:function(){return n.call(this,arguments,"define",function(a,b){a.namespace.set(a.path,b)})},extend:function(){return n.call(this,arguments,"extend",function(a,b){a.namespace.extend(a.path,b)})},condition:function(){return n.call(this,arguments,"condition",function(a,b){b&&a.namespace.set(a.path,b)})},require:function(){var a=d.matchArgs(arguments,{dependencies:"array",hiddenDependencies:"array",callback:"function",context:"object"});a.callback=a.callback||function(){};var b=a.dependencies||[],c=b.concat(a.hiddenDependencies||[]),e=c.length,f=[],g={};if(e)for(var h=function(b){this.i<f.length&&(f[this.i]=b),e--,0===e&&(f.push(g),a.callback.apply(a.context||this.ctx,f))},i=0;i<c.length;++i){var j=this.resolve(c[i]);i<b.length&&f.push(null),j.namespace.obtain(j.path,h,{ctx:this,i:i})}else f.push(g),a.callback.apply(a.context||this,f);return this},digest:function(a){var b=this.resolve(a);return b.namespace.digest(b.path),this}}}var c={get:function(a){return"undefined"!=typeof window?window[a]:"undefined"!=typeof global?global[a]:null},set:function(a,b){return"undefined"!=typeof window&&(window[a]=b),"undefined"!=typeof global&&(global[a]=b),b},setPath:function(a,b){var c=a.split(".");if(1==c.length)return this.set(a,b);for(var d=this.get(c[0])||this.set(c[0],{}),e=1;e<c.length-1;++e)c[e]in d||(d[c[e]]={}),d=d[c[e]];return d[c[c.length-1]]=b,b},getPath:function(a){var b=a.split(".");if(1==b.length)return this.get(a);for(var c=this.get(b[0]),d=1;d<b.length;++d){if(!c)return c;c=c[b[d]]}return c}},d={method:function(a,b){return function(){return b.apply(a,arguments)}},extend:function(a,b){a=a||{},b=b||{};for(var c in b)a[c]=b[c];return a},typeOf:function(a){return"[object Array]"===Object.prototype.toString.call(a)?"array":typeof a},isEmpty:function(a){if(null===a||"undefined"==typeof a)return!0;if("array"==this.typeOf(a))return 0===a.length;if("object"!=typeof a)return!1;for(var b in a)return!1;return!0},matchArgs:function(a,b){var c=0,d={};for(var e in b)b[e]===!0||this.typeOf(a[c])==b[e]?(d[e]=a[c],c++):"undefined"==this.typeOf(a[c])&&c++;return d},stringify:function(a){return"function"==this.typeOf(a)?""+a:JSON.stringify(a)}},e={__namespace:"Scoped",upgrade:function(a){var b=c.get(a||e.__namespace);if(b&&"object"==d.typeOf(b)&&b.guid==this.guid&&"string"==d.typeOf(b.version)){for(var f=this.version.split("."),g=b.version.split("."),h=!1,i=0;i<Math.min(f.length,g.length)&&(h=f[i]>g[i],f[i]==g[i]);++i);return h?this.attach(a):b}return this.attach(a)},attach:function(a){a&&(e.__namespace=a);var b=c.get(e.__namespace);return b==this?this:(e.__revert=b,c.set(e.__namespace,this),this)},detach:function(a){return a&&c.set(e.__namespace,null),"undefined"!=typeof e.__revert&&c.set(e.__namespace,e.__revert),delete e.__revert,this},exports:function(a,b,c){return a=a||("undefined"!=typeof module?module:null),"object"==typeof a&&a&&"exports"in a&&(c||a.exports==this||!a.exports||d.isEmpty(a.exports))&&(a.exports=b||this),this}},f=a({tree:!0,global:!0}),g=a({tree:!0}),h=b(null,g,g,f),i=d.extend(h,{guid:"4b6878ee-cb6a-46b3-94ac-27d91f58d666",version:"9.1427403679672",upgrade:e.upgrade,attach:e.attach,detach:e.detach,exports:e.exports});return i=i.upgrade(),i.exports(),i}.call(this);(function(){var a=this.subScope();a.binding("module","global:BetaJS.Browser"),a.binding("base","global:BetaJS"),a.binding("jquery","global:jQuery"),a.define("base:$",["jquery:"],function(a){return a}),a.define("module:",function(){return{guid:"02450b15-9bbf-4be2-b8f6-b483bc015d06",version:"13.1427409166594"}}),a.define("module:JQueryAjax",["base:Net.AbstractAjax","base:Net.AjaxException","base:Promise","module:Info","jquery:"],function(a,b,c,d,e,f){return a.extend({scoped:f},function(){return{_syncCall:function(a){var c;return e.ajax({type:a.method,async:!1,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){c=a},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(f){e=JSON.parse('"'+a.responseText+'"')}throw new b(a.status,d,e)}}),c},_asyncCall:function(a){var f=c.create();return d.isInternetExplorer()&&d.internetExplorerVersion()<=9&&(e.support.cors=!0),e.ajax({type:a.method,async:!0,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){f.asyncSuccess(a)},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(g){e=JSON.parse('"'+a.responseText+'"')}f.asyncError(new b(a.status,d,e))}}),f}}})}),a.define("module:Cookies",["base:Strings"],function(a){return{get:function(b){return a.read_cookie_string(document.cookie,b)},set:function(b,c){document.cookie=a.write_cookie_string(document.cookie,b,c)}}}),a.define("module:Dom",["base:Objs","jquery:"],function(a,b){return{changeTag:function(a,b){for(var c=document.createElement(b),d=0;d<a.attributes.length;++d)c.setAttribute(a.attributes[d].nodeName,a.attributes[d].nodeValue);for(;a.firstChild;)c.appendChild(a.firstChild);return a.parentNode.replaceChild(c,a),c},traverseNext:function(a,c){return"get"in a&&(a=a.get(0)),a.firstChild&&!c?b(a.firstChild):a.parentNode?a.nextSibling?b(a.nextSibling):this.traverseNext(a.parentNode,!0):null},selectNode:function(a,c){a=b(a).get(0);var d=null,e=null;window.getSelection?(d=window.getSelection(),d.removeAllRanges(),e=document.createRange()):document.selection&&(d=document.selection,e=d.createRange()),c?(e.setStart(a,c),e.setEnd(a,c),d.addRange(e)):(e.selectNode(a),d.addRange(e))},selectionStartNode:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).startContainer):document.selection?b(document.selection.createRange().startContainer):null},selectedHtml:function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().htmlText:""},selectionAncestor:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).commonAncestorContainer):document.selection?b(document.selection.createRange().parentElement()):null},selectionStartOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).startOffset:document.selection?document.selection.createRange().startOffset:null},selectionEndOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).endOffset:document.selection?document.selection.createRange().endOffset:null},selectionStart:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).startContainer):document.selection?b(document.selection.createRange().startContainer):null},selectionEnd:function(){return window.getSelection?b(window.getSelection().getRangeAt(0).endContainer):document.selection?b(document.selection.createRange().endContainer):null},selectionNonEmpty:function(){var a=this.selectionStart(),b=this.selectionEnd();return a&&b&&a.get(0)&&b.get(0)&&(a.get(0)!=b.get(0)||this.selectionStartOffset()!=this.selectionEndOffset())},selectionContained:function(a){return a.has(this.selectionStart()).length>0&&a.has(this.selectionEnd()).length>0},selectionNodes:function(){var a=[],b=this.selectionStart(),c=this.selectionEnd();a.push(b);for(var d=b;d.get(0)!=c.get(0);)d=this.traverseNext(d),a.push(d);return a},selectionLeaves:function(){return a.filter(this.selectionNodes(),function(a){return 0===a.children().length})},contentSiblings:function(a){return a.parent().contents().filter(function(){return this!=a.get(0)})},remove_tag_from_parent_path:function(a,c,d){c=c.toLowerCase(),a=b(a);for(var e=a.parents(d?d+" "+c:c),f=0;f<e.length;++f){var g=e.get(f);for(g=b(g);a.get(0)!=g.get(0);)this.contentSiblings(a).wrap("<"+c+"></"+c+">"),a=a.parent();g.contents().unwrap()}},selectionSplitOffsets:function(){var a=this.selectionStartOffset(),c=this.selectionEndOffset(),d=this.selectionStart(),e=this.selectionEnd(),f=d.get(0)==e.get(0);if(c<e.get(0).wholeText.length){var g=e.get(0);g.splitText(c),e=b(g),f&&(d=e)}a>0&&(d=b(d.get(0).splitText(a)),f&&(e=d)),this.selectRange(d,e)},selectRange:function(a,c,d,e){a=b(a),c=b(c);var f=null,g=null;window.getSelection?(f=window.getSelection(),f.removeAllRanges(),g=document.createRange()):document.selection&&(f=document.selection,g=f.createRange()),g.setStart(a.get(0),d||0),g.setEnd(c.get(0),e||c.get(0).data.length),f.addRange(g)},splitNode:function(a,c,d){if(a=b(a),c=c||0,d=d||a.get(0).data.length,d<a.get(0).data.length){var e=a.get(0);e.splitText(d),a=b(e)}return c>0&&(a=b(a.get(0).splitText(c))),a}}}),a.define("module:FlashDetect",["base:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(){if(a.constructor.call(this),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var b="application/x-shockwave-flash",c=navigator.mimeTypes;c&&c[b]&&c[b].enabledPlugin&&c[b].enabledPlugin.description&&(this.__version=this.parseVersion(c[b].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var d=0;d<this.__activeXDetectRules.length;d++)try{var e=new ActiveXObject(this.__activeXDetectRules[d].name),f=this.__activeXDetectRules[d].version(e);if(f){this.__version=this.parseActiveXVersion(f);break}}catch(g){}},parseVersion:function(a){var b=a.split(/ +/),c=b[2].split(/\./),d=b[3];return{raw:a,major:parseInt(c[0],10),minor:parseInt(c[1],10),revisionStr:d,revision:parseInt(d.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(a){var b=a.split(",");return{raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],10),revision:parseInt(b[2],10),revisionStr:b[2]}},version:function(){return this.__version},installed:function(){return null!==this.__version},supported:function(){var a=navigator.userAgent;return this.installed()||!(-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad"))},majorAtLeast:function(a){return this.installed()&&this.version().major>=a},minorAtLeast:function(a){return this.installed()&&this.version().minor>=a},revisionAtLeast:function(a){return this.installed()&&this.version().revision>=a},versionAtLeast:function(){if(!this.installed())return!1;for(var a=[this.version().major,this.version().minor,this.version().revision],b=Math.min(a.length,arguments.length),c=0;b>c;c++)if(a[c]!=arguments[c])return a[c]>arguments[c];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(a){try{a.AllowScriptAccess="always";try{return a.GetVariable("$version")}catch(b){return null}}catch(b){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}}]}})}),a.define("module:FlashHelper",["base:Time","base:Objs","base:Types","base:Net.Uri","module:Info","jquery:"],function(a,b,c,d,e,f){return{getFlashObject:function(a){var b=f(a).find("embed").get(0);if(e.isInternetExplorer()&&e.internetExplorerVersion()<=10&&(b=null),b||(b=f(a).find("object").get(0)),!b)for(var c=f("object"),d=0;d<c.length;++d)f(c[d]).closest(a).length>0&&(b=f(c[d]));return b},embedTemplate:function(e){e=e||{};var f=[];f.push({objectKey:"classid",value:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"}),f.push({objectKey:"codebase",value:"http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab"}),f.push({embedKey:"align",value:"middle"}),f.push({embedKey:"play",value:"true"}),f.push({embedKey:"loop",value:"false"}),f.push({embedKey:"type",value:"application/x-shockwave-flash"}),f.push({embedKey:"pluginspage",value:"http://www.adobe.com/go/getflashplayer"}),f.push({objectParam:"quality",embedKey:"quality",value:"high"}),f.push({objectParam:"allowScriptAccess",embedKey:"allowScriptAccess",value:"always"}),f.push({objectParam:"wmode",embedKey:"wmode",value:"opaque"}),f.push({objectParam:"movie",embedKey:"src",value:e.flashFile+(e.forceReload?"?"+a.now():"")}),e.width&&f.push({objectKey:"width",embedKey:"width",value:e.width}),e.height&&f.push({objectKey:"height",embedKey:"height",value:e.height}),e.bgcolor&&f.push({objectParam:"bgcolor",embedKey:"bgcolor",value:e.bgcolor}),e.FlashVars&&f.push({objectParam:"FlashVars",embedKey:"FlashVars",value:c.is_object(e.FlashVars)?d.encodeUriParams(e.FlashVars):e.FlashVars});var g=[],h=[],i=[];return b.iter(f,function(a){a.objectKey&&g.push(a.objectKey+'="'+a.value+'"'),a.embedKey&&i.push(a.embedKey+'="'+a.value+'"'),a.objectParam&&h.push('<param name="'+a.objectParam+'" value="'+a.value+'" />')},this),"<object "+g.join(" ")+">"+h.join(" ")+"<embed "+i.join(" ")+"></embed></object>"},embedFlashObject:function(a,b){return f(a).html(this.embedTemplate(b)),this.getFlashObject(a)}}}),a.define("module:Hotkeys",["base:Objs","jquery:"],function(a,b){return{SHIFT_NUMS:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},SPECIAL_KEYS:{esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},MODIFIERS:["ctrl","alt","shift","meta"],keyCodeToCharacter:function(a){return 188==a?",":190==a?".":String.fromCharCode(a).toLowerCase()},register:function(c,d,e,f){var g=this;f=a.extend({type:"keyup",propagate:!1,disable_in_input:!1,target:document,keycode:!1},f),f.target=b(f.target);var h=c.toLowerCase().split("+"),i=function(b){if(f.disable_in_input){var c=b.target||b.srcElement||null;if(c&&3==c.nodeType&&(c=c.parentNode),c&&("INPUT"==c.tagName||"TEXTAREA"==c.tagName))return}var i=b.keyCode||b.which||0,j=g.keyCodeToCharacter(i),k=0,l={};a.iter(g.MODIFIERS,function(a){l[a]={pressed:b[a+"Key"],wanted:!1}},this),a.iter(h,function(a){a in l?(l[a].wanted=!0,k++):a.length>1?g.SPECIAL_KEYS[a]==i&&k++:f.keycode?f.keycode==i&&k++:(j==a||b.shiftKey&&g.SHIFT_NUMS[j]==a)&&k++},this),k==h.length&&a.all(l,function(a){return a.wanted==a.pressed})&&(d.apply(e||this),f.propagate||b.preventDefault())};return f.target.on(f.type,i),{target:f.target,type:f.type,func:i}},unregister:function(a){a.target.off(a.type,a.func)}}}),a.define("module:Info",["module:FlashDetect"],function(a){return{getNavigator:function(){return{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent}},__cache:{},__cached:function(a,b){return a in this.__cache||(this.__cache[a]=b.apply(this)),this.__cache[a]},flash:function(){return this.__cached("flash",function(){return new a})},isiOS:function(){return this.__cached("isiOS",function(){var a=navigator.userAgent;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")})},isChrome:function(){return this.__cached("isChrome",function(){return("chrome"in window||-1!=navigator.userAgent.indexOf("CriOS"))&&!window.opera&&-1===navigator.userAgent.indexOf(" OPR/")})},isOpera:function(){return this.__cached("isOpera",function(){return!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0})},isAndroid:function(){return this.__cached("isAndroid",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")})},isWebOS:function(){return this.__cached("isWebOS",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("webos")})},isWindowsPhone:function(){return this.__cached("isWindowsPhone",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")})},isBlackberry:function(){return this.__cached("isBlackberry",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("blackberry")})},iOSversion:function(){return this.__cached("iOSversion",function(){if(!this.isiOS())return!1;var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(a[1],10),minor:parseInt(a[2],10),revision:parseInt(a[3]||0,10)}})},isMobile:function(){return this.__cached("isMobile",function(){return this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()})},isInternetExplorer:function(){return this.__cached("isInternetExplorer",function(){return null!==this.internetExplorerVersion()})},isFirefox:function(){return this.__cached("isFirefox",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("firefox")})},isSafari:function(){return this.__cached("isSafari",function(){return!this.isChrome()&&-1!=navigator.userAgent.toLowerCase().indexOf("safari")})},isWindows:function(){return this.__cached("isWindows",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("win")})},isMacOS:function(){return this.__cached("isMacOS",function(){return!this.isiOS()&&-1!=navigator.appVersion.toLowerCase().indexOf("mac")})},isUnix:function(){return this.__cached("isUnix",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("x11")})},isLinux:function(){return this.__cached("isLinux",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("linux")})},internetExplorerVersion:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),b=a.exec(navigator.userAgent);if(b)return b[1]}else if("Netscape"==navigator.appName){var c=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),d=c.exec(navigator.userAgent);if(d)return parseFloat(d[1])}return null},inIframe:function(){try{return window.self!==window.top}catch(a){return!0}},formatDevice:function(){return this.isMobile()?"Mobile":"Desktop"},formatOS:function(){return this.__cached("formatOS",function(){return this.isMacOS()?"Mac OS-X":this.isWindows()?"Windows":this.isUnix()?"Unix":this.isLinux()?"Linux":this.isiOS()?"iOS "+this.iOSversion().major+"."+this.iOSversion().minor+"."+this.iOSversion().revision:this.isAndroid()?"Android":this.isWebOS()?"WebOS":this.isWindowsPhone()?"Windows Phone":this.isBlackberry()?"Blackberry":"Unknown Operating System"})},formatBrowser:function(){return this.__cached("formatBrowser",function(){return this.isChrome()?"Chrome":this.isOpera()?"Opera":this.isInternetExplorer()?"Internet Explorer "+this.internetExplorerVersion():this.isFirefox()?"Firefox":this.isSafari()?"Safari":this.isAndroid()?"Android":this.isWebOS()?"WebOS":this.isWindowsPhone()?"Windows Phone":this.isBlackberry()?"Blackberry":"Unknown Browser"})},formatFlash:function(){return this.flash().installed()?"Flash "+this.flash().version().raw:this.flash().supported()?"Flash not installed but supported":"Flash not supported"}}}),a.define("module:Loader",["jquery:"],function(a){return{loadScript:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},loadStyles:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("link");f.rel="stylesheet",f.href=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.call(c||this,a))},e.appendChild(f)},inlineStyles:function(b){a("<style>"+b+"</style>").appendTo("head")},loadHtml:function(b,c,d){a.ajax({url:b,dataType:"html"}).done(function(a){c.call(d||this,a,b)})}}}),a.define("module:Router",["base:Class","base:Events.EventsMixin","base:Events.Events","base:Functions","base:Types","base:Objs"],function(a,b,c,d,e,f,g){return a.extend({scoped:g},[b,function(a){return{routes:[],constructor:function(b){a.constructor.call(this);var c=e.is_function(this.routes)?this.routes():this.routes;e.is_array(c)||(c=[c]),"routes"in b&&(e.is_array(b.routes)?c=c.concat(b.routes):c.push(b.routes)),this.__routes=[],this.__paths={},this.__current=null,f.iter(c,function(a){f.iter(a,function(a,b){e.is_string(a)&&(a={action:a}),a.key=b,a.route=new RegExp("^"+b+"$"),"applicable"in a?e.is_array(a.applicable)||(a.applicable=[a.applicable]):a.applicable=[],"valid"in a?e.is_array(a.valid)||(a.valid=[a.valid]):a.valid=[],"path"in a||(a.path=a.key),this.__routes.push(a),this.__paths[a.path]=a},this)},this),b.actions&&f.iter(b.actions,function(a,b){this[b]=a},this)},destroy:function(){this.__leave(),a.destroy.call(this)},parse:function(a){for(var b=0;b<this.__routes.length;++b){var c=this.__routes[b],d=c.route.exec(a);if(null!==d){d.shift(1);for(var f=!0,g=0;g<c.applicable.length;++g){var h=c.applicable[g],i=e.is_string(h)?this[h]:h;f=f&&i.apply(this,d)}if(!f)continue;for(var j=!0,k=0;k<c.valid.length;++k){var l=c.valid[k],m=e.is_string(l)?this[l]:l;j=j&&m.apply(this,d)}return j?{object:c,params:d}:null}}return null},object:function(a){return this.__paths[a]},path:function(a){for(var b=this.object(a).key,c=Array.prototype.slice.apply(arguments,[1]),d=/\(.*?\)/;;){var e=c.shift();if(!e)break;b=b.replace(d,e)}return b},navigate:function(a){this.trigger("navigate",a);var b=this.parse(a);return null===b?(this.trigger("navigate-fail",a),!1):(this.trigger("navigate-success",b.object,b.params),this.invoke(b.object,b.params,a))},invoke:function(a,b,c){c=c||this.path(a.key,b),this.trigger("before_invoke",a,b,c),this.__enter(a,b,c),this.trigger("after_invoke",a,b,c);var d=this._invoke(a,b);return d},_invoke:function(a,b){var c=a.action;return e.is_string(c)&&(c=this[c]),c?c.apply(this,b):!1},__leave:function(){null!==this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(a,b,d){this.__leave(),this.__current=new c,this.__current.route=d,this.__current.object=a,this.__current.params=b,this.trigger("enter",this.__current)},current:function(){return this.__current}}}])}),a.define("module:RouterHistory",["base:Class","base:Events.EventsMixin"],function(a,b,c){return a.extend({scoped:c},[b,function(a){return{constructor:function(b){a.constructor.call(this),this.__router=b,this.__history=[],b.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),a.destroy.call(this)},__after_invoke:function(a,b){this.__history.push({object:a,params:b}),this.trigger("change")},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this.__history.length},get:function(a){return a=a||0,this.__history[a]},getRoute:function(a){var b=this.get(a);return this.__router.path(b.object.path,b.params)},back:function(a){if(this.count()<2)return null;for(a=a||0;a>=0&&this.count()>1;)this.__history.pop(),--a;var b=this.__history.pop();return this.trigger("change"),this.__router.invoke(b.object,b.params)}}}])}),a.define("module:RouteBinder",["base:Class"],function(a,b){return a.extend({scoped:b},function(a){return{constructor:function(b){a.constructor.call(this),this.__router=b,this.__router.on("after_invoke",function(a,b,c){this._getExternalRoute()!=c&&this._setExternalRoute(c,b,a)},this)},destroy:function(){this.__router.off(null,null,this),a.destroy.call(this)},current:function(){return this._getExternalRoute()},_setRoute:function(a){var b=this.__router.current();b&&b.route==a||this.__router.navigate(a)},_getExternalRoute:function(){return null},_setExternalRoute:function(){}}})}),a.define("module:HashRouteBinder",["module:RouteBinder","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,c);var d=this;b(window).on("hashchange.events"+this.cid(),function(){d._setRoute(d._getExternalRoute())})},destroy:function(){b(window).off("hashchange.events"+this.cid()),a.destroy.call(this)},_getExternalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setExternalRoute:function(a){window.location.hash="#"+a}}})}),a.define("module:HistoryRouteBinder",["module:RouteBinder","jquery:"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c){a.constructor.call(this,c);var d=this;this.__used=!1,b(window).on("popstate.events"+this.cid(),function(){d.__used&&d._setRoute(d._getExternalRoute())})},destroy:function(){b(window).off("popstate.events"+this.cid()),a.destroy.call(this)},_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.history.pushState({},document.title,a),this.__used=!0}}},{supported:function(){return window.history&&window.history.pushState}})}),a.define("module:LocationRouteBinder",["module:RouteBinder"],function(a,b){return a.extend({scoped:b},{_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.location.pathname=a}})}),a.define("module:StateRouteBinder",["module:RouteBinder","base:Objs"],function(a,b,c){return a.extend({scoped:c},function(a){return{constructor:function(c,d){a.constructor.call(this,c),this._host=d,this._states={},b.iter(c.routes,function(a){a.state&&(this._states[a.state]=a)},this),d.on("start",function(){this._setRoute(this._getExternalRoute)},this)},destroy:function(){this._host.off(null,null,this),a.destroy.call(this)},_getExternalRoute:function(){var a=this._host.state(),c=this._states[a.state_name()];if(!c)return null;var d=/\(.*?\)/,e=c.key;return b.iter(c.mapping,function(b){e=e.replace(d,a["_"+b])},this),e},_setExternalRoute:function(a,c,d){var e={};b.iter(d.mapping,function(a,b){e[a]=c[b]}),this._host.next(d.state,e)}}})})}).call(Scoped);