/*!
betajs-browser - v1.0.0 - 2014-10-08
Copyright (c) Oliver Friedmann
MIT Software License.
*/
BetaJS.Net.AbstractAjax.extend("BetaJS.Browser.JQueryAjax",{_syncCall:function(e){var t;return BetaJS.$.ajax({type:e.method,async:!1,url:e.uri,dataType:e.decodeType?e.decodeType:null,data:e.encodeType&&"json"==e.encodeType?JSON.stringify(e.data):e.data,success:function(e){t=e},error:function(e,t,n){var r="";try{r=JSON.parse(e.responseText)}catch(i){r=JSON.parse('"'+e.responseText+'"')}throw new BetaJS.Net.AjaxException(e.status,n,ee)}}),t},_asyncCall:function(e,t){BetaJS.Browser.Info.isInternetExplorer()&&9>=BetaJS.Browser.Info.internetExplorerVersion()&&(BetaJS.$.support.cors=!0),BetaJS.$.ajax({type:e.method,async:!0,url:e.uri,dataType:e.decodeType?e.decodeType:null,data:e.encodeType&&"json"==e.encodeType?JSON.stringify(e.data):e.data,success:function(e){BetaJS.SyncAsync.callback(t,"success",e)},error:function(e,n,r){var i="";try{i=JSON.parse(e.responseText)}catch(o){i=JSON.parse('"'+e.responseText+'"')}var a=new BetaJS.Net.AjaxException(e.status,r,i);BetaJS.SyncAsync.callback(t,"exception",a)}})}}),BetaJS.Browser.Cookies={get:function(e){return BetaJS.Strings.read_cookie_string(document.cookie,e)},set:function(e,t){document.cookie=BetaJS.Strings.write_cookie_string(document.cookie,e,t)}},BetaJS.Browser.Dom={traverseNext:function(e,t){return"get"in e&&(e=e.get(0)),e.firstChild&&!t?BetaJS.$(e.firstChild):e.parentNode?e.nextSibling?BetaJS.$(e.nextSibling):this.traverseNext(e.parentNode,!0):null},selectNode:function(e,t){e=BetaJS.$(e).get(0);var n=null,r=null;window.getSelection?(n=window.getSelection(),n.removeAllRanges(),r=document.createRange()):document.selection&&(n=document.selection,r=n.createRange()),t?(r.setStart(e,t),r.setEnd(e,t),n.addRange(r)):(r.selectNode(e),n.addRange(r))},selectionStartNode:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectedHtml:function(){return window.getSelection?""+window.getSelection():document.selection?document.selection.createRange().htmlText:""},selectionAncestor:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).commonAncestorContainer):document.selection?BetaJS.$(document.selection.createRange().parentElement()):null},selectionStartOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).startOffset:document.selection?document.selection.createRange().startOffset:null},selectionEndOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).endOffset:document.selection?document.selection.createRange().endOffset:null},selectionStart:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectionEnd:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).endContainer):document.selection?BetaJS.$(document.selection.createRange().endContainer):null},selectionNonEmpty:function(){var e=this.selectionStart(),t=this.selectionEnd();return e&&t&&e.get(0)&&t.get(0)&&(e.get(0)!=t.get(0)||this.selectionStartOffset()!=this.selectionEndOffset())},selectionContained:function(e){return e.has(this.selectionStart()).length>0&&e.has(this.selectionEnd()).length>0},selectionNodes:function(){var e=[],t=this.selectionStart(),n=this.selectionEnd();e.push(t);for(var r=t;r.get(0)!=n.get(0);)r=this.traverseNext(r),e.push(r);return e},selectionLeaves:function(){return BetaJS.Objs.filter(this.selectionNodes(),function(e){return 0===e.children().length})},contentSiblings:function(e){return e.parent().contents().filter(function(){return this!=e.get(0)})},remove_tag_from_parent_path:function(e,t,n){t=t.toLowerCase(),e=BetaJS.$(e);for(var r=e.parents(n?n+" "+t:t),i=0;r.length>i;++i){var o=r.get(i);for(o=BetaJS.$(o);e.get(0)!=o.get(0);)this.contentSiblings(e).wrap("<"+t+"></"+t+">"),e=e.parent();o.contents().unwrap()}},selectionSplitOffsets:function(){var e=this.selectionStartOffset(),t=this.selectionEndOffset(),n=this.selectionStart(),r=this.selectionEnd(),i=n.get(0)==r.get(0);if(r.get(0).wholeText.length>t){var o=r.get(0);o.splitText(t),r=BetaJS.$(o),i&&(n=r)}e>0&&(n=BetaJS.$(n.get(0).splitText(e)),i&&(r=n)),this.selectRange(n,r)},selectRange:function(e,t,n,r){e=BetaJS.$(e),t=BetaJS.$(t);var i=null,o=null;window.getSelection?(i=window.getSelection(),i.removeAllRanges(),o=document.createRange()):document.selection&&(i=document.selection,o=i.createRange()),o.setStart(e.get(0),n||0),o.setEnd(t.get(0),r||t.get(0).data.length),i.addRange(o)},splitNode:function(e,t,n){if(e=BetaJS.$(e),t=t||0,n=n||e.get(0).data.length,e.get(0).data.length>n){var r=e.get(0);r.splitText(n),e=BetaJS.$(r)}return t>0&&(e=BetaJS.$(e.get(0).splitText(t))),e}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Hotkeys={SHIFT_NUMS:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},SPECIAL_KEYS:{esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},MODIFIERS:["ctrl","alt","shift","meta"],keyCodeToCharacter:function(e){return 188==e?",":190==e?".":String.fromCharCode(e).toLowerCase()},register:function(e,t,n,r){r=BetaJS.Objs.extend({type:"keyup",propagate:!1,disable_in_input:!1,target:document,keycode:!1},r),r.target=BetaJS.$(r.target);var i=e.toLowerCase().split("+"),o=function(e){if(r.disable_in_input){var o=e.target||e.srcElement||null;if(o&&3==o.nodeType&&(o=o.parentNode),o&&("INPUT"==o.tagName||"TEXTAREA"==o.tagName))return}var a=e.keyCode||e.which||0,s=BetaJS.Browser.Hotkeys.keyCodeToCharacter(a),c=0,u={};BetaJS.Objs.iter(BetaJS.Browser.Hotkeys.MODIFIERS,function(t){u[t]={pressed:e[t+"Key"],wanted:!1}},this),BetaJS.Objs.iter(i,function(t){t in u?(u[t].wanted=!0,c++):t.length>1?BetaJS.Browser.Hotkeys.SPECIAL_KEYS[t]==a&&c++:r.keycode?r.keycode==a&&c++:(s==t||e.shiftKey&&BetaJS.Browser.Hotkeys.SHIFT_NUMS[s]==t)&&c++},this),c==i.length&&BetaJS.Objs.all(u,function(e){return e.wanted==e.pressed})&&(t.apply(n||this),r.propagate||e.preventDefault())};return r.target.on(r.type,o),{target:r.target,type:r.type,func:o}},unregister:function(e){e.target.off(e.type,e.func)}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Info={getNavigator:function(){return{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent}},__cache:{},__cached:function(e,t){return e in this.__cache||(this.__cache[e]=t.apply(this)),this.__cache[e]},flash:function(){return this.__cached("flash",function(){return new BetaJS.Browser.FlashDetect})},isiOS:function(){return this.__cached("isiOS",function(){var e=navigator.userAgent;return-1!=e.indexOf("iPhone")||-1!=e.indexOf("iPod")||-1!=e.indexOf("iPad")})},isChrome:function(){return this.__cached("isChrome",function(){return("chrome"in window||-1!=navigator.userAgent.indexOf("CriOS"))&&!window.opera&&-1===navigator.userAgent.indexOf(" OPR/")})},isOpera:function(){return this.__cached("isOpera",function(){return!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0})},isAndroid:function(){return this.__cached("isAndroid",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")})},isWebOS:function(){return this.__cached("isWebOS",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("webos")})},isWindowsPhone:function(){return this.__cached("isWindowsPhone",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")})},isBlackberry:function(){return this.__cached("isBlackberry",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("blackberry")})},iOSversion:function(){return this.__cached("iOSversion",function(){if(!this.isiOS())return!1;var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(e[1],10),minor:parseInt(e[2],10),revision:parseInt(e[3]||0,10)}})},isMobile:function(){return this.__cached("isMobile",function(){return this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()})},isInternetExplorer:function(){return this.__cached("isInternetExplorer",function(){return null!==this.internetExplorerVersion()})},isFirefox:function(){return this.__cached("isFirefox",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("firefox")})},isSafari:function(){return this.__cached("isSafari",function(){return!this.isChrome()&&-1!=navigator.userAgent.toLowerCase().indexOf("safari")})},isWindows:function(){return this.__cached("isWindows",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("win")})},isMacOS:function(){return this.__cached("isMacOS",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("mac")})},isUnix:function(){return this.__cached("isUnix",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("x11")})},isLinux:function(){return this.__cached("isLinux",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("linux")})},internetExplorerVersion:function(){if("Microsoft Internet Explorer"==navigator.appName){var e=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(e.exec(navigator.userAgent))return parseFloat(RegExp.$1)}else if("Netscape"==navigator.appName){var t=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(t.exec(navigator.userAgent))return parseFloat(RegExp.$1)}return null},inIframe:function(){try{return window.self!==window.top}catch(e){return!0}}},BetaJS.Class.extend("BetaJS.Browser.FlashDetect",{constructor:function(){if(this._inherited(BetaJS.Browser.FlashDetect,"constructor"),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var e="application/x-shockwave-flash",t=navigator.mimeTypes;t&&t[e]&&t[e].enabledPlugin&&t[e].enabledPlugin.description&&(this.__version=this.parseVersion(t[e].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var n=0;this.__activeXDetectRules.length>n;n++)try{var r=new ActiveXObject(this.__activeXDetectRules[n].name),i=this.__activeXDetectRules[n].version(r);if(i){this.__version=this.parseActiveXVersion(i);break}}catch(o){}},parseVersion:function(e){var t=e.split(/ +/),n=t[2].split(/\./),r=t[3];return{raw:e,major:parseInt(n[0],10),minor:parseInt(n[1],10),revisionStr:r,revision:parseInt(r.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(e){var t=e.split(",");return{raw:e,major:parseInt(t[0].split(" ")[1],10),minor:parseInt(t[1],10),revision:parseInt(t[2],10),revisionStr:t[2]}},version:function(){return this.__version},installed:function(){return null!==this.__version},supported:function(){return this.installed()||!BetaJS.Browser.Info.isiOS()},majorAtLeast:function(e){return this.installed()&&this.version().major>=e},minorAtLeast:function(e){return this.installed()&&this.version().minor>=e},revisionAtLeast:function(e){return this.installed()&&this.version().revision>=e},versionAtLeast:function(){if(!this.installed())return!1;var e=[this.version().major,this.version().minor,this.version().revision],t=Math.min(e.length,arguments.length);for(i=0;t>i;i++)if(e[i]!=arguments[i])return e[i]>arguments[i];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(e){try{return e.GetVariable("$version")}catch(t){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(e){try{e.AllowScriptAccess="always";try{return e.GetVariable("$version")}catch(t){return null}}catch(t){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(e){try{return e.GetVariable("$version")}catch(t){return null}}}]}),BetaJS.$="jQuery"in window?window.jQuery:null,BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Loader={loadScript:function(e,t,n){var r=!1,i=document.getElementsByTagName("head")[0],o=document.createElement("script");o.src=e,o.onload=o.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,o.onload=o.onreadystatechange=null,t&&t.apply(n||this,[e]))},i.appendChild(o)},loadStyles:function(e,t,n){var r=!1,i=document.getElementsByTagName("head")[0],o=document.createElement("link");o.rel="stylesheet",o.href=e,o.onload=o.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,o.onload=o.onreadystatechange=null,t&&t.apply(n||this,[e]))},i.appendChild(o)},inlineStyles:function(e){BetaJS.$("<style>"+e+"</style>").appendTo("head")}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Router=BetaJS.Class.extend("BetaJS.Browser.Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(e){this._inherited(BetaJS.Browser.Router,"constructor");var t=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(t)||(t=[t]),"routes"in e&&(BetaJS.Types.is_array(e.routes)?t=t.concat(e.routes):t.push(e.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(t,function(e){BetaJS.Objs.iter(e,function(e,t){BetaJS.Types.is_string(e)&&(e={action:e}),e.key=t,e.route=RegExp("^"+t+"$"),"applicable"in e?BetaJS.Types.is_array(e.applicable)||(e.applicable=[e.applicable]):e.applicable=[],"valid"in e?BetaJS.Types.is_array(e.valid)||(e.valid=[e.valid]):e.valid=[],"path"in e||(e.path=e.key),this.__routes.push(e),this.__paths[e.path]=e},this)},this),"actions"in e&&BetaJS.Objs.iter(e.actions,function(e,t){this[t]=e},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Browser.Router,"destroy")},parse:function(e){for(var t=0;this.__routes.length>t;++t){var n=this.__routes[t],r=n.route.exec(e);if(null!==r){r.shift(1);var i=!0;if(BetaJS.Objs.iter(n.applicable,function(e){var t=BetaJS.Types.is_string(e)?this[e]:e;i=i&&t.apply(this,r)},this),!i)continue;var o=!0;return BetaJS.Objs.iter(n.valid,function(e){var t=BetaJS.Types.is_string(e)?this[e]:e;o=o&&t.apply(this,r)},this),o?{object:n,params:r}:null}}return null},object:function(e){return this.__paths[e]},path:function(e){for(var t=this.object(e).key,n=Array.prototype.slice.apply(arguments,[1]),r=/\(.*?\)/;;){var i=n.shift();if(!i)break;t=t.replace(r,i)}return t},navigate:function(e){this.trigger("navigate",e);var t=this.parse(e);return null===t?(this.trigger("navigate-fail",e),!1):(this.trigger("navigate-success",t.object,t.params),this.invoke(t.object,t.params,e))},invoke:function(e,t,n){n=n||this.path(e.key,t),this.trigger("before_invoke",e,t,n),this.__enter(e,t,n),this.trigger("after_invoke",e,t,n);var r=this._invoke(e,t);return r},_invoke:function(e,t){var n=e.action;return BetaJS.Types.is_string(n)&&(n=this[n]),n.apply(this,t)},__leave:function(){null!==this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(e,t,n){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=n,this.__current.object=e,this.__current.params=t,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Class.extend("BetaJS.Browser.RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(e){this._inherited(BetaJS.Browser.RouterHistory,"constructor"),this.__router=e,this.__history=[],e.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouterHistory,"destroy")},__after_invoke:function(e,t){this.__history.push({object:e,params:t}),this.trigger("change")},last:function(e){return e=e||0,this.get(this.count()-1-e)},count:function(){return this.__history.length},get:function(e){return e=e||0,this.__history[e]},getRoute:function(e){var t=this.get(e);return this.__router.path(t.object.path,t.params)},back:function(e){if(2>this.count())return null;for(e=e||0;e>=0&&this.count()>1;)this.__history.pop(),--e;var t=this.__history.pop();return this.trigger("change"),this.__router.invoke(t.object,t.params)}}]),BetaJS.Class.extend("BetaJS.Browser.RouteBinder",{constructor:function(e){this._inherited(BetaJS.Browser.RouteBinder,"constructor"),this.__router=e,this.__router.on("after_invoke",function(e,t,n){this._getExternalRoute()!=n&&this._setExternalRoute(n)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouteBinder,"destroy")},current:function(){return this._getExternalRoute()},_setRoute:function(e){var t=this.__router.current();t&&t.route==e||this.__router.navigate(e)},_getExternalRoute:function(){return""},_setExternalRoute:function(){}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HashRouteBinder",{constructor:function(e){this._inherited(BetaJS.Browser.HashRouteBinder,"constructor",e);var t=this;BetaJS.$(window).on("hashchange.events"+this.cid(),function(){t._setRoute(t._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Browser.HashRouteBinder,"destroy")},_getExternalRoute:function(){var e=window.location.hash;return e.length&&"#"==e[0]?e.slice(1):e},_setExternalRoute:function(e){window.location.hash="#"+e}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HistoryRouteBinder",{constructor:function(e){this._inherited(BetaJS.Browser.HistoryRouteBinder,"constructor",e);var t=this;this.__used=!1,BetaJS.$(window).on("popstate.events"+this.cid(),function(){t.__used&&t._setRoute(t._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("popstate.events"+this.cid()),this._inherited(BetaJS.Browser.HistoryRouteBinder,"destroy")},_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(e){window.history.pushState({},document.title,e),this.__used=!0}},{supported:function(){return window.history&&window.history.pushState}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.LocationRouteBinder",{_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(e){window.location.pathname=e}});