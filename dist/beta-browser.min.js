/*!
betajs-browser - v1.0.0 - 2014-12-09
Copyright (c) Oliver Friedmann
MIT Software License.
*/
BetaJS.Net.AbstractAjax.extend("BetaJS.Browser.JQueryAjax",{_syncCall:function(a){var b;return BetaJS.$.ajax({type:a.method,async:!1,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){b=a},error:function(a,b,c){var d="";try{d=JSON.parse(a.responseText)}catch(e){d=JSON.parse('"'+a.responseText+'"')}throw new BetaJS.Net.AjaxException(a.status,c,ee)}}),b},_asyncCall:function(a,b){BetaJS.Browser.Info.isInternetExplorer()&&BetaJS.Browser.Info.internetExplorerVersion()<=9&&(BetaJS.$.support.cors=!0),BetaJS.$.ajax({type:a.method,async:!0,url:a.uri,dataType:a.decodeType?a.decodeType:null,data:a.encodeType&&"json"==a.encodeType?JSON.stringify(a.data):a.data,success:function(a){b&&b.success&&b.success.call(b.context||this,a),b&&b.complete&&b.complete.call(b.context||this)},error:function(a,c,d){var e="";try{e=JSON.parse(a.responseText)}catch(f){e=JSON.parse('"'+a.responseText+'"')}var g=new BetaJS.Net.AjaxException(a.status,d,e);b&&b.exception&&b.exception.call(b.context||this,g),b&&b.complete&&b.complete.call(b.context||this)}})}}),BetaJS.Browser.Cookies={get:function(a){return BetaJS.Strings.read_cookie_string(document.cookie,a)},set:function(a,b){document.cookie=BetaJS.Strings.write_cookie_string(document.cookie,a,b)}},BetaJS.Browser.Dom={traverseNext:function(a,b){return"get"in a&&(a=a.get(0)),a.firstChild&&!b?BetaJS.$(a.firstChild):a.parentNode?a.nextSibling?BetaJS.$(a.nextSibling):this.traverseNext(a.parentNode,!0):null},selectNode:function(a,b){a=BetaJS.$(a).get(0);var c=null,d=null;window.getSelection?(c=window.getSelection(),c.removeAllRanges(),d=document.createRange()):document.selection&&(c=document.selection,d=c.createRange()),b?(d.setStart(a,b),d.setEnd(a,b),c.addRange(d)):(d.selectNode(a),c.addRange(d))},selectionStartNode:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectedHtml:function(){return window.getSelection?window.getSelection().toString():document.selection?document.selection.createRange().htmlText:""},selectionAncestor:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).commonAncestorContainer):document.selection?BetaJS.$(document.selection.createRange().parentElement()):null},selectionStartOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).startOffset:document.selection?document.selection.createRange().startOffset:null},selectionEndOffset:function(){return window.getSelection?window.getSelection().getRangeAt(0).endOffset:document.selection?document.selection.createRange().endOffset:null},selectionStart:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).startContainer):document.selection?BetaJS.$(document.selection.createRange().startContainer):null},selectionEnd:function(){return window.getSelection?BetaJS.$(window.getSelection().getRangeAt(0).endContainer):document.selection?BetaJS.$(document.selection.createRange().endContainer):null},selectionNonEmpty:function(){var a=this.selectionStart(),b=this.selectionEnd();return a&&b&&a.get(0)&&b.get(0)&&(a.get(0)!=b.get(0)||this.selectionStartOffset()!=this.selectionEndOffset())},selectionContained:function(a){return a.has(this.selectionStart()).length>0&&a.has(this.selectionEnd()).length>0},selectionNodes:function(){var a=[],b=this.selectionStart(),c=this.selectionEnd();a.push(b);for(var d=b;d.get(0)!=c.get(0);)d=this.traverseNext(d),a.push(d);return a},selectionLeaves:function(){return BetaJS.Objs.filter(this.selectionNodes(),function(a){return 0===a.children().length})},contentSiblings:function(a){return a.parent().contents().filter(function(){return this!=a.get(0)})},remove_tag_from_parent_path:function(a,b,c){b=b.toLowerCase(),a=BetaJS.$(a);for(var d=a.parents(c?c+" "+b:b),e=0;e<d.length;++e){var f=d.get(e);for(f=BetaJS.$(f);a.get(0)!=f.get(0);)this.contentSiblings(a).wrap("<"+b+"></"+b+">"),a=a.parent();f.contents().unwrap()}},selectionSplitOffsets:function(){var a=this.selectionStartOffset(),b=this.selectionEndOffset(),c=this.selectionStart(),d=this.selectionEnd(),e=c.get(0)==d.get(0);if(b<d.get(0).wholeText.length){var f=d.get(0);f.splitText(b),d=BetaJS.$(f),e&&(c=d)}a>0&&(c=BetaJS.$(c.get(0).splitText(a)),e&&(d=c)),this.selectRange(c,d)},selectRange:function(a,b,c,d){a=BetaJS.$(a),b=BetaJS.$(b);var e=null,f=null;window.getSelection?(e=window.getSelection(),e.removeAllRanges(),f=document.createRange()):document.selection&&(e=document.selection,f=e.createRange()),f.setStart(a.get(0),c||0),f.setEnd(b.get(0),d||b.get(0).data.length),e.addRange(f)},splitNode:function(a,b,c){if(a=BetaJS.$(a),b=b||0,c=c||a.get(0).data.length,c<a.get(0).data.length){var d=a.get(0);d.splitText(c),a=BetaJS.$(d)}return b>0&&(a=BetaJS.$(a.get(0).splitText(b))),a}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Hotkeys={SHIFT_NUMS:{"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"},SPECIAL_KEYS:{esc:27,escape:27,tab:9,space:32,"return":13,enter:13,backspace:8,scrolllock:145,scroll_lock:145,scroll:145,capslock:20,caps_lock:20,caps:20,numlock:144,num_lock:144,num:144,pause:19,"break":19,insert:45,home:36,"delete":46,end:35,pageup:33,page_up:33,pu:33,pagedown:34,page_down:34,pd:34,left:37,up:38,right:39,down:40,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123},MODIFIERS:["ctrl","alt","shift","meta"],keyCodeToCharacter:function(a){return 188==a?",":190==a?".":String.fromCharCode(a).toLowerCase()},register:function(a,b,c,d){d=BetaJS.Objs.extend({type:"keyup",propagate:!1,disable_in_input:!1,target:document,keycode:!1},d),d.target=BetaJS.$(d.target);var e=a.toLowerCase().split("+"),f=function(a){if(d.disable_in_input){var f=a.target||a.srcElement||null;if(f&&3==f.nodeType&&(f=f.parentNode),f&&("INPUT"==f.tagName||"TEXTAREA"==f.tagName))return}var g=a.keyCode||a.which||0,h=BetaJS.Browser.Hotkeys.keyCodeToCharacter(g),i=0,j={};BetaJS.Objs.iter(BetaJS.Browser.Hotkeys.MODIFIERS,function(b){j[b]={pressed:a[b+"Key"],wanted:!1}},this),BetaJS.Objs.iter(e,function(b){b in j?(j[b].wanted=!0,i++):b.length>1?BetaJS.Browser.Hotkeys.SPECIAL_KEYS[b]==g&&i++:d.keycode?d.keycode==g&&i++:(h==b||a.shiftKey&&BetaJS.Browser.Hotkeys.SHIFT_NUMS[h]==b)&&i++},this),i==e.length&&BetaJS.Objs.all(j,function(a){return a.wanted==a.pressed})&&(b.apply(c||this),d.propagate||a.preventDefault())};return d.target.on(d.type,f),{target:d.target,type:d.type,func:f}},unregister:function(a){a.target.off(a.type,a.func)}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Info={getNavigator:function(){return{appCodeName:navigator.appCodeName,appName:navigator.appName,appVersion:navigator.appVersion,cookieEnabled:navigator.cookieEnabled,onLine:navigator.onLine,platform:navigator.platform,userAgent:navigator.userAgent}},__cache:{},__cached:function(a,b){return a in this.__cache||(this.__cache[a]=b.apply(this)),this.__cache[a]},flash:function(){return this.__cached("flash",function(){return new BetaJS.Browser.FlashDetect})},isiOS:function(){return this.__cached("isiOS",function(){var a=navigator.userAgent;return-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")||-1!=a.indexOf("iPad")})},isChrome:function(){return this.__cached("isChrome",function(){return("chrome"in window||-1!=navigator.userAgent.indexOf("CriOS"))&&!window.opera&&-1===navigator.userAgent.indexOf(" OPR/")})},isOpera:function(){return this.__cached("isOpera",function(){return!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0})},isAndroid:function(){return this.__cached("isAndroid",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("android")})},isWebOS:function(){return this.__cached("isWebOS",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("webos")})},isWindowsPhone:function(){return this.__cached("isWindowsPhone",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("windows phone")})},isBlackberry:function(){return this.__cached("isBlackberry",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("blackberry")})},iOSversion:function(){return this.__cached("iOSversion",function(){if(!this.isiOS())return!1;var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return{major:parseInt(a[1],10),minor:parseInt(a[2],10),revision:parseInt(a[3]||0,10)}})},isMobile:function(){return this.__cached("isMobile",function(){return this.isiOS()||this.isAndroid()||this.isWebOS()||this.isWindowsPhone()||this.isBlackberry()})},isInternetExplorer:function(){return this.__cached("isInternetExplorer",function(){return null!==this.internetExplorerVersion()})},isFirefox:function(){return this.__cached("isFirefox",function(){return-1!=navigator.userAgent.toLowerCase().indexOf("firefox")})},isSafari:function(){return this.__cached("isSafari",function(){return!this.isChrome()&&-1!=navigator.userAgent.toLowerCase().indexOf("safari")})},isWindows:function(){return this.__cached("isWindows",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("win")})},isMacOS:function(){return this.__cached("isMacOS",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("mac")})},isUnix:function(){return this.__cached("isUnix",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("x11")})},isLinux:function(){return this.__cached("isLinux",function(){return-1!=navigator.appVersion.toLowerCase().indexOf("linux")})},internetExplorerVersion:function(){if("Microsoft Internet Explorer"==navigator.appName){var a=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})");if(a.exec(navigator.userAgent))return parseFloat(RegExp.$1)}else if("Netscape"==navigator.appName){var b=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");if(b.exec(navigator.userAgent))return parseFloat(RegExp.$1)}return null},inIframe:function(){try{return window.self!==window.top}catch(a){return!0}}},BetaJS.Class.extend("BetaJS.Browser.FlashDetect",{constructor:function(){if(this._inherited(BetaJS.Browser.FlashDetect,"constructor"),this.__version=null,navigator.plugins&&navigator.plugins.length>0){var a="application/x-shockwave-flash",b=navigator.mimeTypes;b&&b[a]&&b[a].enabledPlugin&&b[a].enabledPlugin.description&&(this.__version=this.parseVersion(b[a].enabledPlugin.description))}else if(-1==navigator.appVersion.indexOf("Mac")&&window.execScript)for(var c=0;c<this.__activeXDetectRules.length;c++)try{var d=new ActiveXObject(this.__activeXDetectRules[c].name),e=this.__activeXDetectRules[c].version(d);if(e){this.__version=this.parseActiveXVersion(e);break}}catch(f){}},parseVersion:function(a){var b=a.split(/ +/),c=b[2].split(/\./),d=b[3];return{raw:a,major:parseInt(c[0],10),minor:parseInt(c[1],10),revisionStr:d,revision:parseInt(d.replace(/[a-zA-Z]/g,""),10)}},parseActiveXVersion:function(a){var b=a.split(",");return{raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],10),revision:parseInt(b[2],10),revisionStr:b[2]}},version:function(){return this.__version},installed:function(){return null!==this.__version},supported:function(){return this.installed()||!BetaJS.Browser.Info.isiOS()},majorAtLeast:function(a){return this.installed()&&this.version().major>=a},minorAtLeast:function(a){return this.installed()&&this.version().minor>=a},revisionAtLeast:function(a){return this.installed()&&this.version().revision>=a},versionAtLeast:function(){if(!this.installed())return!1;var a=[this.version().major,this.version().minor,this.version().revision],b=Math.min(a.length,arguments.length);for(i=0;b>i;i++)if(a[i]!=arguments[i])return a[i]>arguments[i];return!0},__activeXDetectRules:[{name:"ShockwaveFlash.ShockwaveFlash.7",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}},{name:"ShockwaveFlash.ShockwaveFlash.6",version:function(a){try{a.AllowScriptAccess="always";try{return a.GetVariable("$version")}catch(b){return null}}catch(b){return"6,0,21"}}},{name:"ShockwaveFlash.ShockwaveFlash",version:function(a){try{return a.GetVariable("$version")}catch(b){return null}}}]}),BetaJS.$="jQuery"in window?window.jQuery:null,BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Loader={loadScript:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.src=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.apply(c||this,[a]))},e.appendChild(f)},loadStyles:function(a,b,c){var d=!1,e=document.getElementsByTagName("head")[0],f=document.createElement("link");f.rel="stylesheet",f.href=a,f.onload=f.onreadystatechange=function(){d||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(d=!0,f.onload=f.onreadystatechange=null,b&&b.apply(c||this,[a]))},e.appendChild(f)},inlineStyles:function(a){BetaJS.$("<style>"+a+"</style>").appendTo("head")}},BetaJS.Browser=BetaJS.Browser||{},BetaJS.Browser.Router=BetaJS.Class.extend("BetaJS.Browser.Router",[BetaJS.Events.EventsMixin,{routes:[],constructor:function(a){this._inherited(BetaJS.Browser.Router,"constructor");var b=BetaJS.Types.is_function(this.routes)?this.routes():this.routes;BetaJS.Types.is_array(b)||(b=[b]),"routes"in a&&(BetaJS.Types.is_array(a.routes)?b=b.concat(a.routes):b.push(a.routes)),this.__routes=[],this.__paths={},this.__current=null,BetaJS.Objs.iter(b,function(a){BetaJS.Objs.iter(a,function(a,b){BetaJS.Types.is_string(a)&&(a={action:a}),a.key=b,a.route=new RegExp("^"+b+"$"),"applicable"in a?BetaJS.Types.is_array(a.applicable)||(a.applicable=[a.applicable]):a.applicable=[],"valid"in a?BetaJS.Types.is_array(a.valid)||(a.valid=[a.valid]):a.valid=[],"path"in a||(a.path=a.key),this.__routes.push(a),this.__paths[a.path]=a},this)},this),"actions"in a&&BetaJS.Objs.iter(a.actions,function(a,b){this[b]=a},this)},destroy:function(){this.__leave(),this._inherited(BetaJS.Browser.Router,"destroy")},parse:function(a){for(var b=0;b<this.__routes.length;++b){var c=this.__routes[b],d=c.route.exec(a);if(null!==d){d.shift(1);var e=!0;if(BetaJS.Objs.iter(c.applicable,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;e=e&&b.apply(this,d)},this),!e)continue;var f=!0;return BetaJS.Objs.iter(c.valid,function(a){var b=BetaJS.Types.is_string(a)?this[a]:a;f=f&&b.apply(this,d)},this),f?{object:c,params:d}:null}}return null},object:function(a){return this.__paths[a]},path:function(a){for(var b=this.object(a).key,c=Array.prototype.slice.apply(arguments,[1]),d=/\(.*?\)/;;){var e=c.shift();if(!e)break;b=b.replace(d,e)}return b},navigate:function(a){this.trigger("navigate",a);var b=this.parse(a);return null===b?(this.trigger("navigate-fail",a),!1):(this.trigger("navigate-success",b.object,b.params),this.invoke(b.object,b.params,a))},invoke:function(a,b,c){c=c||this.path(a.key,b),this.trigger("before_invoke",a,b,c),this.__enter(a,b,c),this.trigger("after_invoke",a,b,c);var d=this._invoke(a,b);return d},_invoke:function(a,b){var c=a.action;return BetaJS.Types.is_string(c)&&(c=this[c]),c.apply(this,b)},__leave:function(){null!==this.__current&&(this.trigger("leave",this.__current),this.__current.destroy(),this.__current=null)},__enter:function(a,b,c){this.__leave(),this.__current=new BetaJS.Events.Events,this.__current.route=c,this.__current.object=a,this.__current.params=b,this.trigger("enter",this.__current)},current:function(){return this.__current}}]),BetaJS.Class.extend("BetaJS.Browser.RouterHistory",[BetaJS.Events.EventsMixin,{constructor:function(a){this._inherited(BetaJS.Browser.RouterHistory,"constructor"),this.__router=a,this.__history=[],a.on("after_invoke",this.__after_invoke,this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouterHistory,"destroy")},__after_invoke:function(a,b){this.__history.push({object:a,params:b}),this.trigger("change")},last:function(a){return a=a||0,this.get(this.count()-1-a)},count:function(){return this.__history.length},get:function(a){return a=a||0,this.__history[a]},getRoute:function(a){var b=this.get(a);return this.__router.path(b.object.path,b.params)},back:function(a){if(this.count()<2)return null;for(a=a||0;a>=0&&this.count()>1;)this.__history.pop(),--a;var b=this.__history.pop();return this.trigger("change"),this.__router.invoke(b.object,b.params)}}]),BetaJS.Class.extend("BetaJS.Browser.RouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.RouteBinder,"constructor"),this.__router=a,this.__router.on("after_invoke",function(a,b,c){this._getExternalRoute()!=c&&this._setExternalRoute(c)},this)},destroy:function(){this.__router.off(null,null,this),this._inherited(BetaJS.Browser.RouteBinder,"destroy")},current:function(){return this._getExternalRoute()},_setRoute:function(a){var b=this.__router.current();b&&b.route==a||this.__router.navigate(a)},_getExternalRoute:function(){return""},_setExternalRoute:function(){}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HashRouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.HashRouteBinder,"constructor",a);var b=this;BetaJS.$(window).on("hashchange.events"+this.cid(),function(){b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("hashchange.events"+this.cid()),this._inherited(BetaJS.Browser.HashRouteBinder,"destroy")},_getExternalRoute:function(){var a=window.location.hash;return a.length&&"#"==a[0]?a.slice(1):a},_setExternalRoute:function(a){window.location.hash="#"+a}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.HistoryRouteBinder",{constructor:function(a){this._inherited(BetaJS.Browser.HistoryRouteBinder,"constructor",a);var b=this;this.__used=!1,BetaJS.$(window).on("popstate.events"+this.cid(),function(){b.__used&&b._setRoute(b._getExternalRoute())})},destroy:function(){BetaJS.$(window).off("popstate.events"+this.cid()),this._inherited(BetaJS.Browser.HistoryRouteBinder,"destroy")},_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.history.pushState({},document.title,a),this.__used=!0}},{supported:function(){return window.history&&window.history.pushState}}),BetaJS.Browser.RouteBinder.extend("BetaJS.Browser.LocationRouteBinder",{_getExternalRoute:function(){return window.location.pathname},_setExternalRoute:function(a){window.location.pathname=a}});